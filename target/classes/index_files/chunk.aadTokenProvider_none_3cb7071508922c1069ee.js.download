(window.webpackJsonpc07208f0_ea3b_4c1a_9965_ac1b825211a6_1_15_0=window.webpackJsonpc07208f0_ea3b_4c1a_9965_ac1b825211a6_1_15_0||[]).push([[0],{NUTh:function(e,t,n){"use strict";n.r(t),n.d(t,"DeferredAadTokenProvider",function(){return u});var a=n("17wl"),i=n("UWqr"),r=n("ut3N"),o=n("NJ9J"),s=n("MGiw"),c=function(){function e(){}return e.isRemoveLegacyAuthProvidersFlightEnabled=function(){return i._SPFlight.isEnabled(60446)},e}();function d(){return i._SPKillSwitch.isActivated("dd3dba4e-4baa-4bd3-95bf-64ffae9b7b51")}var l=function(e){function t(t,n){var a=e.call(this,t)||this;return a.code=n,a}return Object(a.__extends)(t,e),t}(Error),u=function(){function e(e,t,n,a,r,o){this._oboFirstPartyTokenCallback=r,this._oboThirdPartyTokenCallback=o,i.Validate.isNonemptyString(n.aadInstanceUrl,"aadInstanceUrl"),i.Validate.isNonemptyString(n.aadTenantId,"aadTenantId"),i.Validate.isNonemptyString(n.redirectUri,"redirectUri"),i.Validate.isNonemptyString(n.servicePrincipalId,"servicePrincipalId"),this._defaultConfiguration=n,this._oboConfiguration=a,this._tokenAcquisitionEvent=e,this.onBeforeRedirectEvent=t,this._failedTokenRequests=new Map}return e.prototype.getToken=function(e,t){return void 0===t&&(t=!0),this._defaultConfiguration.servicePrincipalId===i.Guid.empty.toString()?Promise.reject(new Error(o.n)):this._getTokenInternal(e,this._defaultConfiguration,t)},e.prototype._getTokenData=function(e,t,n){if(void 0===t&&(t=!0),void 0===n&&(n=!1),this._defaultConfiguration.servicePrincipalId===i.Guid.empty.toString())return Promise.reject(new Error(o.n));if(this._shouldUseMsalTokenProvider())return this._getMsalTokenProvider(this._defaultConfiguration).then(function(a){return a.getTokenData(e,t,n)});throw new Error("Getting token response not supported for the current token provider")},e.prototype._getTokenInternal=function(e,t,n){var a=this;void 0===n&&(n=!0);var o=new r._QosMonitor("AadTokenProvider.GetAppTokenTimePerf");if(!this._shouldTokenBeRequested(e))throw o.writeExpectedFailure("Token already requested and failed"),i._SPKillSwitch.isActivated("a4a3d2f4-ad0e-4684-adee-a5ceec193558")?Error("Token request previously failed"):new l("Token request previously failed","TokenRequestPreviouslyFailed");var c=t||this._defaultConfiguration;return(this._shouldUseOboTokenExchange()&&this._oboConfiguration?this._getOboTokenProvider(c,this._oboConfiguration,this._oboFirstPartyTokenCallback,this._oboThirdPartyTokenCallback).then(function(t){return a._getToken(t,e,n)}):this._shouldUseMsalTokenProvider()?this._getMsalTokenProvider(c).then(function(t){return a._getToken(t,e,n)}):this._getImplicitTokenProvider(c).then(function(t){return a._getToken(t,e,n)})).then(function(t){var n=c.servicePrincipalId===s.e.PRE_AUTHORIZED_APP_PRINCIPAL_ID,a={isInternal:n};return n&&(a.name=e),o.writeSuccess(a),t}).catch(function(t){throw o.writeUnexpectedFailure(),a._addFailedRequest(e),t})},e.prototype._addFailedRequest=function(e){d()||this._failedTokenRequests.set(e,new Date(Date.now()))},e.prototype._shouldTokenBeRequested=function(e){if(!d()){var t=this._failedTokenRequests.get(e);if(t)return Date.now()-t.getTime()>3e5}return!0},e.prototype._getToken=function(e,t,n){return e.getToken(t,n)},Object.defineProperty(e.prototype,"tokenAcquisitionEvent",{get:function(){return this._tokenAcquisitionEvent},enumerable:!1,configurable:!0}),e.prototype._shouldUseMsalTokenProvider=function(){var e=!!i.Guid.tryParse(this._defaultConfiguration.aadSessionId),t=e||c.isRemoveLegacyAuthProvidersFlightEnabled();if(!e){t&&(this._defaultConfiguration.aadSessionId="");var n=new r._QosMonitor("DeferredAadTokenProvider._shouldUseMsalTokenProvider"),a={aadSessionId:this._defaultConfiguration.aadSessionId};n.writeUnexpectedFailure("isAadSessionIdValidGuid",void 0,a)}return t},e.prototype._getAdalAuthContextManager=function(e){return this._authContextManager||(this._authContextManager=Promise.all([n.e(7),n.e(1)]).then(n.bind(null,"z1gO")).then(function(e){return new e.AdalAuthContextManager})),this._authContextManager},e.prototype._getMsalTokenProvider=function(e){var t=this;return Promise.all([n.e(8),n.e(3)]).then(n.bind(null,"X7FI")).then(function(n){return t._isFirstParty(e.servicePrincipalId)?(t._firstPartyMsalTokenProvider||(t._firstPartyMsalTokenProvider=new n.MsalTokenProvider(e)),t._firstPartyMsalTokenProvider):(t._thirdPartyMsalTokenProvider||(t._thirdPartyMsalTokenProvider=new n.MsalTokenProvider(e)),t._thirdPartyMsalTokenProvider)})},e.prototype._getImplicitTokenProvider=function(e){var t=this;return n.e(6).then(n.bind(null,"onrO")).then(function(n){return t._isFirstParty(e.servicePrincipalId)?(t._firstPartyImplicitTokenProvider||(t._firstPartyImplicitTokenProvider=new n.ImplicitFlowTokenProvider(e)),t._firstPartyImplicitTokenProvider):(t._thirdPartyImplicitTokenProvider||(t._thirdPartyImplicitTokenProvider=new n.ImplicitFlowTokenProvider(e)),t._thirdPartyImplicitTokenProvider)})},e.prototype._getOboTokenProvider=function(e,t,n,a){var i=this;return this._getAdalAuthContextManager(e).then(function(r){return i._isFirstParty(e.servicePrincipalId)?(i._firstPartyOboTokenProvider||(i._firstPartyOboTokenProvider=r.getOboTokenProvider(e,t,n,a)),i._firstPartyOboTokenProvider):(i._thirdPartyOboTokenProvider||(i._thirdPartyOboTokenProvider=r.getOboTokenProvider(e,t,n,a)),i._thirdPartyOboTokenProvider)})},e.prototype._isFirstParty=function(e){return e===s.e.PRE_AUTHORIZED_APP_PRINCIPAL_ID},e.prototype._shouldUseOboTokenExchange=function(){return!!this._oboConfiguration},e}()}}]);