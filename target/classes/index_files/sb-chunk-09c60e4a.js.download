(window.msfast_searchux_sb_jsonp=window.msfast_searchux_sb_jsonp||[]).push([["cpl-exit~cpl-host~cpl-invoker~cpl-no-submit~pp-comp~sc-comp~stream"],{NQus:function(e,t,r){"use strict";function a(e){var t=0,r=(e||"").trim().replace(/\s+/," ");return r&&(t=r.length),{characterCount:t,wordCount:0,wordLengths:[]}}r.d(t,"a",function(){return a})},zH9T:function(e,t,r){"use strict";r.d(t,"a",function(){return f});var a=r("D57K"),i=r("CVAo"),n=r("anwg"),o=r("Ak5F");var s=r("PtyX");r("gDU4"),r("hTSy"),r("FoV5");function c(e){return e&&Object(s.a)(e,function(e){return"string"==typeof e||"number"==typeof e?e:JSON.stringify(e)})}r("25hB");var d=r("ohlq");function u(e){var t={LogicalId:e.logicalSearchId,ConversationId:e.conversationId,TraceId:e.traceId,Version:2,LocalTime:Object(n.a)(e.localTimeOverride||new Date),ImpressionType:e.impressionType,ScenarioName:e.scenarioName,ProviderName:e.providerName,Results:e.dataSourceEntities,Part:e.part||0};Object(o.a)({eventType:"USAGE",name:"ClientDataSource",properties:Object(a.__assign)({},c(t))})}var l=r("W4Bk"),p=function(e){var t=e.logicalSearchId,r=void 0===t?Object(l.a)():t,a=e.conversationId,i=e.layoutType,o=e.resultsView,s=e.part,c=e.verticalType,d=e.pageNumber,u=e.metadata;return{LogicalId:r,ConversationId:a,Version:2,LocalTime:Object(n.a)(new Date),LayoutType:i,Part:s,ResultsView:o,VerticalType:c,PageNumber:d,metadata:u}};function h(e){var t=e.logicalSearchId,r=e.conversationId,a=e.traceId,i=e.status,n=e.providerName,s=e.latency,c=e.requestParams;Object(o.a)({eventType:"USAGE",name:"ResponseReceived",properties:{LogicalId:t,ConversationId:r,Version:2,TraceId:a,Status:i,ProviderName:n,Latency:s,nameDetail:n,RequestParams:JSON.stringify(c)}})}var m=r("xo1z"),I=r("D7WJ"),v=r("UkL6"),y=r("Tc2z"),g=r("+3Pp"),T=void 0;function f(e,t,r,a,i,n,o,s){return new S(e,t,r,a,i,n,o,s)}var S=function(){function e(e,t,r,a,i,n,o,s){this.fetchStartTime=e,this.searchTextCharacteristics=t,this.logicalSearchId=r,this.conversationId=a,this.items=i,this.instrumenter=n,this.activatedTime=o,this.inputTime=s,this.isDispatched=!1}return e.prototype.dispatch=function(){if(!this.isDispatched){this.isDispatched=!0,T=T&&T.logicalId===this.logicalSearchId?{logicalId:this.logicalSearchId,part:T.part+1}:{logicalId:this.logicalSearchId,part:0};var e={eventType:"USAGE",nameDetail:"Searchbox.Impression",name:"searchbox_impression",properties:{impressionId:this.logicalSearchId,conversationId:this.conversationId,fetchStartTime:Math.round(this.fetchStartTime),activatedTime:this.activatedTime&&Math.round(this.activatedTime),inputTime:this.inputTime&&Math.round(this.inputTime),characterCount:this.searchTextCharacteristics.characterCount,items:JSON.stringify(this.items.map(function(e){return Object(a.__assign)(Object(a.__assign)({},e),{emitTime:Math.round(e.emitTime),delayTime:Math.round(e.delayTime)})}))}};Object(o.a)(e),this.dispatchCachedContentRenderedByLogicalId(),this.dispatchResultsRenderedByTraceId();var t={};if(this.instrumenter&&this.instrumenter.props.spInfo){var r=this.instrumenter.props.spInfo;t.WebId=r.webId,t.SiteId=r.siteId}else t=void 0;!function(e){var t=e.logicalSearchId,r=e.conversationId,i=e.layoutType,n=e.resultsView,s=e.nameDetail,d=e.part,u=e.verticalType,l=e.pageNumber,h=e.metadata,m=p({logicalSearchId:t,conversationId:r,layoutType:i,resultsView:n,part:d,verticalType:u,pageNumber:l,metadata:h});Object(o.a)({eventType:"USAGE",name:"ClientLayout",properties:Object(a.__assign)(Object(a.__assign)({},c(m)),{nameDetail:s})})}({logicalSearchId:this.logicalSearchId,conversationId:this.conversationId,layoutType:"Vertical",resultsView:this.getResultsViewForGroups(),nameDetail:"Searchbox.Impression",part:T.part,metadata:t}),this.dispatchClientDataSourceAndResponseRecievedByTraceId()}},e.prototype.dispatchClientDataSourceAndResponseRecievedByTraceId=function(){var e,t,r=this,i=Object(m.a)()||Object(d.a)();if(0!==this.items.length){var n=Object(v.a)(this.items.filter(function(e){return"External"===e.entityType}),function(e){return e.traceId});try{for(var o=Object(a.__values)(Object.keys(n)),s=o.next();!s.done;s=o.next()){var c=s.value,l=n[c],p=l.map(function(e){return{Type:"External"===e.entityType?r.mapGroupIdToEntityType(e.groupId):e.entityType,ReferenceId:e.entityId}}),y=l[0].providerId;u({logicalSearchId:this.logicalSearchId,conversationId:this.conversationId,traceId:c,impressionType:"Suggestions",scenarioName:i,providerName:this.mapProviderIdToProviderName(y),dataSourceEntities:p,part:null==T?void 0:T.part,localTimeOverride:new Date((new Date).getTime()-(Object(I.a)()-(this.inputTime||this.fetchStartTime)))});var g=l[0],f=Math.round(g.emitTime-(this.inputTime||this.fetchStartTime));h({logicalSearchId:this.logicalSearchId,conversationId:this.conversationId,traceId:c,providerName:y,status:200,latency:f,requestParams:{QueryLength:this.searchTextCharacteristics.characterCount}})}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}}else this.dispatchEmptySuggestionInformation(i)},e.prototype.getResultsViewForGroups=function(){var e=this,t=Object(v.a)(this.items,function(e){return e.groupId}),r=Object(y.a)(t,function(t,r){return{Position:t[0].pos,ProviderId:t[0].traceId,Type:"Group",Name:e.mapGroupIdToGroupName(r),ReferenceId:Object(i.a)(),PlacementType:"Visible",LayoutType:"Vertical",ResultsView:e.getResultsViewForSuggestions(t)}});return Object(g.a)(r,function(e){return e.Position}).map(function(e,t){return Object(a.__assign)(Object(a.__assign)({},e),{Position:t+1})})},e.prototype.getResultsViewForSuggestions=function(e){var t=this;return e.map(function(e,r){var a="External"===e.entityType?t.mapGroupIdToEntityType(e.groupId):e.entityType;return{Position:r+1,ProviderId:e.traceId,Type:"Entity",EntityType:a,ReferenceId:e.entityId,PlacementType:"Visible"}})},e.prototype.mapGroupIdToGroupName=function(e){switch(null==e?void 0:e.toLowerCase()){case"peoplepill":return"person";default:return e}},e.prototype.mapGroupIdToEntityType=function(e){switch(null==e?void 0:e.toLowerCase()){case"file":return"File";case"site":return"Site";case"news":return"News";case"app":return"App";case"person":case"peoplepill":return"People";case"bookmark":return"Bookmark";case"querysuggestion":case"querysuggestionprovider":return"TextualSuggestion";default:return"External"}},e.prototype.mapProviderIdToProviderName=function(e){switch(null==e?void 0:e.toLowerCase()){case"querysuggestionprovider":return"SpoTenantTrendingQueriesProvider";default:return e}},e.prototype.dispatchCachedContentRenderedByLogicalId=function(){var e,t,r,i=Object(v.a)(this.items,function(e){return e.fromCache}).true,s=Object(v.a)(i,function(e){return e.originalLogicalSearchId});try{for(var c=Object(a.__values)(Object.keys(s)),d=c.next();!d.done;d=c.next()){var u=d.value;r={logicalSearchId:this.logicalSearchId,originalLogicalSearchId:u,conversationId:this.conversationId,localTimeOverride:new Date((new Date).getTime()-(Object(I.a)()-(this.inputTime||this.fetchStartTime)))},Object(o.a)({eventType:"USAGE",name:"CachedContentRendered",properties:{nameDetail:r.nameDetail,LogicalId:r.originalLogicalSearchId,NewLogicalId:r.logicalSearchId,ConversationId:r.conversationId,Version:2,LocalTime:Object(n.a)(r.localTimeOverride||new Date)}})}}catch(t){e={error:t}}finally{try{d&&!d.done&&(t=c.return)&&t.call(c)}finally{if(e)throw e.error}}},e.prototype.dispatchResultsRenderedByTraceId=function(){var e,t,r,i=Object(v.a)(this.items,function(e){return e.traceId});try{for(var n=Object(a.__values)(Object.keys(i)),s=n.next();!s.done;s=n.next()){var c=s.value,d=i[c][0];r={logicalSearchId:this.logicalSearchId,conversationId:this.conversationId,traceId:c,latency:Math.round(d.emitTime-(this.inputTime||this.fetchStartTime))},Object(o.a)({eventType:"USAGE",name:"ResultsRendered",properties:Object(a.__assign)(Object(a.__assign)({E2ELatency:r.latency},r.renderLatency),{LogicalId:r.logicalSearchId,ConversationId:r.conversationId,TraceId:r.traceId,Version:2,ProviderName:r.providerName,VerticalName:r.verticalName,VerticalId:r.verticalId,properties:JSON.stringify(r.properties),measures:JSON.stringify(r.measures),NavScenario:r.NavScenario,TabInBackground:r.isTabInBackground})})}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},e.prototype.dispatchEmptySuggestionInformation=function(e){var t=Object(i.a)(),r=Object(I.a)()-(this.inputTime||this.fetchStartTime);h({logicalSearchId:this.logicalSearchId,conversationId:this.conversationId,traceId:t,providerName:"EmptySuggestions",status:200,latency:r,requestParams:{QueryLength:this.searchTextCharacteristics.characterCount}}),u({logicalSearchId:this.logicalSearchId,conversationId:this.conversationId,traceId:t,impressionType:"Suggestions",scenarioName:e,providerName:"EmptySuggestions",dataSourceEntities:[],part:null==T?void 0:T.part,localTimeOverride:new Date((new Date).getTime()-(Object(I.a)()-(this.inputTime||this.fetchStartTime)))})},e}()}}]);